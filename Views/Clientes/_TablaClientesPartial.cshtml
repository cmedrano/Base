@model AvicolaApp.Models.DTOs.PaginatedResult<AvicolaApp.Models.Cliente>

@{
    var currentPage = (int)ViewData["CurrentPage"];
    var searchNombre = (string)ViewData["SearchNombre"];
    var searchFantasia = (string)ViewData["SearchFantasia"];
}

<!-- Solo la tabla -->
<tbody id="tablaClientesBody">
    @if (Model.Items.Count > 0)
    {
        @foreach (var item in Model.Items)
        {
            <tr class="fila-cliente">
                <td class="ps-4 py-3">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle text-white d-flex justify-content-center align-items-center me-3 fw-bold shadow-sm" style="width: 40px; height: 40px; background-color: #6f42c1;">
                            @item.Nombre.Substring(0, 1).ToUpper()
                        </div>
                        <div>
                            <div class="fw-bold text-dark">@item.Nombre</div>
                            <div class="small text-secondary"><i class="bi bi-shop me-1"></i>@(item.Fantasia ?? "Sin fantasía")</div>
                        </div>
                    </div>
                </td>
                <td class="py-3">
                    <span class="small">@(item.Telefono ?? "-")</span>
                </td>
                <td class="py-3">
                    <span class="small">@(item.Email ?? "-")</span>
                </td>
                <td class="py-3">
                    @if (!string.IsNullOrEmpty(item.Categoria))
                    {
                        <span class="badge rounded-pill px-3" style="background-color: #6f42c1; color: white;">@item.Categoria</span>
                    }
                    else
                    {
                        <span class="text-secondary small">-</span>
                    }
                </td>
                <td class="pe-4 py-3 text-end">
                    <button class="btn btn-light btn-sm rounded-circle shadow-sm"
                            title="Ver detalles"
                            data-bs-toggle="modal"
                            data-bs-target="#modalVerCliente"
                            data-cliente-id="@item.Id"
                            data-cliente-nombre="@item.Nombre"
                            data-cliente-telefono="@item.Telefono"
                            data-cliente-domicilio="@item.Domicilio"
                            data-cliente-email="@item.Email"
                            data-cliente-celular="@item.Celular"
                            data-cliente-fax="@item.Fax"
                            data-cliente-fantasia="@item.Fantasia"
                            data-cliente-categoria="@item.Categoria"
                            data-cliente-operaciones-contado="@item.OperacionesContado"
                            data-cliente-inhabilitado="@item.InhabilitadoFacturar">
                        <i class="bi bi-eye-fill" style="color: #6f42c1;"></i>
                    </button>

                    <button class="btn btn-light btn-sm rounded-circle shadow-sm"
                            title="Editar Cliente"
                            data-bs-toggle="modal"
                            data-bs-target="#modalEditarCliente"
                            data-cliente-id="@item.Id"
                            data-cliente-nombre="@item.Nombre"
                            data-cliente-telefono="@item.Telefono"
                            data-cliente-domicilio="@item.Domicilio"
                            data-cliente-email="@item.Email"
                            data-cliente-celular="@item.Celular"
                            data-cliente-fax="@item.Fax"
                            data-cliente-fantasia="@item.Fantasia"
                            data-cliente-categoria="@item.Categoria"
                            data-cliente-operaciones-contado="@item.OperacionesContado"
                            data-cliente-inhabilitado="@item.InhabilitadoFacturar">
                        <i class="bi bi-pencil-fill" style="color: #6f42c1;"></i>
                    </button>

                    <button type="button" class="btn btn-light btn-sm rounded-circle shadow-sm" title="Eliminar Cliente" data-bs-toggle="modal" data-bs-target="#modalConfirmarEliminar" data-cliente-id="@item.Id" data-cliente-nombre="@item.Nombre">
                        <i class="bi bi-trash3-fill text-danger"></i>
                    </button>
                </td>
            </tr>
        }
    }
    else
    {
        <tr>
            <td colspan="5" class="text-center py-4 text-muted">
                <i class="bi bi-inbox fs-3 mb-2"></i>
                <p>No hay clientes que coincidan con tu búsqueda.</p>
            </td>
        </tr>
    }
</tbody>

<!-- Paginación -->
@if (Model.TotalPages > 1)
{
    <div class="paginacion-info">
        <div class="text-secondary small">
            Mostrando <strong>@((currentPage - 1) * Model.PageSize + 1)</strong> a <strong>@Math.Min(currentPage * Model.PageSize, Model.TotalCount)</strong> de <strong>@Model.TotalCount</strong> clientes
        </div>
        <nav>
            <ul class="pagination mb-0">
                @if (Model.HasPreviousPage)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("Index", "Clientes", new { page = currentPage - 1, searchNombre, searchFantasia })" style="color: #6f42c1;">
                            <i class="bi bi-chevron-left"></i> Anterior
                        </a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <span class="page-link"><i class="bi bi-chevron-left"></i> Anterior</span>
                    </li>
                }

                @for (int i = Math.Max(1, currentPage - 2); i <= Math.Min(Model.TotalPages, currentPage + 2); i++)
                {
                    if (i == currentPage)
                    {
                        <li class="page-item active">
                            <span class="page-link" style="background-color: #6f42c1; border-color: #6f42c1;">@i</span>
                        </li>
                    }
                    else
                    {
                        <li class="page-item">
                            <a class="page-link" href="@Url.Action("Index", "Clientes", new { page = i, searchNombre, searchFantasia })" style="color: #6f42c1;">@i</a>
                        </li>
                    }
                }

                @if (Model.HasNextPage)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("Index", "Clientes", new { page = currentPage + 1, searchNombre, searchFantasia })" style="color: #6f42c1;">
                            Siguiente <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                }
                else
                {
                    <li class="page-item disabled">
                        <span class="page-link">Siguiente <i class="bi bi-chevron-right"></i></span>
                    </li>
                }
            </ul>
        </nav>
    </div>
}